version: "3"

networks:
  backbone:
    external:
      name: backbone

services:
  console:
    image: christhomas/fakews-console:latest
    build:
      context: console
      dockerfile: Dockerfile
    networks:
      - backbone
    environment:
      - VIRTUAL_HOST=console.aws.develop

  # https://github.com/scality/cloudserver
  s3:
    image: zenko/cloudserver:latest
    networks:
      - backbone
    volumes:
      - $PWD/data/s3:/data
      - $PWD/config/s3/config.json:/usr/src/app/config.json
    environment:
      - VIRTUAL_HOST=~^(|[a-z0-9]+\.)s3.aws.develop
      - VIRTUAL_PORT=8000
      - S3DATAPATH=/data
      - REMOTE_MANAGEMENT_DISABLE=1
      - SCALITY_ACCESS_KEY_ID=mock
      - SCALITY_SECRET_ACCESS_KEY=mock

  # https://hub.docker.com/r/amazon/dynamodb-local/
  dynamodb:
    image: amazon/dynamodb-local
    networks:
      - backbone
    environment:
      - VIRTUAL_HOST=dynamodb.aws.develop
      - VIRTUAL_PORT=8000

  # https://github.com/airdock-io/docker-fake-sns
  sns:
    image: airdock/fake-sns
    networks:
      - backbone
    volumes:
      - $PWD/data/sns:/srv/ruby/fake-sns
    environment:
      - VIRTUAL_HOST=~^sns.([a-z0-9\-]+).aws.develop
      - VIRTUAL_PORT=9292

  # https://github.com/softwaremill/elasticmq
  sqs:
    image: softwaremill/elasticmq:latest
    networks:
      - backbone
    volumes:
      - $PWD/config/sqs/custom.conf:/opt/elasticmq.conf
    environment:
      - QUEUE_HOST=sqs.eu-west-1.aws.develop
      - VIRTUAL_HOST=~^sqs.([a-z0-9\-]+).aws.develop
      - VIRTUAL_PORT=9324

#  sqs-experimental:
#    image: softwaremill/elasticmq-native:latest
#    networks:
#      - backbone
#    volumes:
#      - $PWD/config/sqs/custom.conf:/opt/elasticmq.conf
#    environment:
#      - QUEUE_HOST=sqs.eu-central-1.aws.develop
#      - VIRTUAL_HOST=~^sqs.([a-z0-9\-]+).aws.develop
#      - VIRTUAL_PORT=9324

  # https://github.com/picadoh/motocker
  iam:
    image: picadoh/motocker:latest
    networks:
      - backbone
    environment:
      - VIRTUAL_HOST=iam.aws.develop
      - VIRTUAL_PORT=5000
      - MOTO_SERVICE=iam


  # https://github.com/picadoh/motocker
  cloudwatch_2:
    image: christhomas/motocker:latest
    networks:
      - backbone
    environment:
      - VIRTUAL_HOST=~^logs.([a-z0-9\-]+).aws.develop
      - VIRTUAL_PORT=5000
      - MOTO_SERVICE=cloudwatch

  # TODO: https://github.com/lambci/docker-lambda
  # TODO: https://medium.com/albert-franzi/accessing-s3-data-through-sql-with-presto-ddb6d4fbb99c


